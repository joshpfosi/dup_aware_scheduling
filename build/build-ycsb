#! /bin/bash
#
# Script to copy and install YCSB on Emulab clients
#
# Usage: build-ycsb <NUM_CLIENTS>

if [ "$#" -ne 1 ]; then
  echo "Usage: $0 <NUM_CLIENTS>"
  exit 1
fi

EMULAB_USER=jpfosi01
SSH="ssh -o UserKnownHostsFile=/dev/null -o StrictHostKeyChecking=no -o ServerAliveInterval=100"

NUM_CLIENTS=$1

echo "Zipping temporary YCSB_unaware for copying..."
zip -ru YCSB_unaware YCSB_unaware > /dev/null

for i in `seq $NUM_CLIENTS`;
do
  (
  HOST=$EMULAB_USER@client-$i.dup.comp150.emulab.net
  echo "Installing YCSB_unaware on $HOST..."
  scp YCSB_unaware.zip $HOST:/usr/local/comp112
  cat setup-ycsb | $SSH $HOST
  ) &
done

wait
